<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PhotoSnap Studio</title>
  <link rel="stylesheet" href="./main2.css">
  <!-- <script defer src="./main2.js"></script> -->
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <script>



// async function matchFromAirtable(email, password) {
//     const url = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}?filterByFormula=AND(email='${email}', password='${password}')`;

//     try {
//         const response = await fetch(url, {
//             method: "GET",
//             headers: {
//                 Authorization: `Bearer ${API_KEY}`,
//                 "Content-Type": "application/json",
//             },
//         });

//         const responseBody = await response.json();

//         if (response.ok && responseBody.records.length > 0) {
//             alert("Login successful!");
//             console.log("Login successful", responseBody);
            
//             // Redirect to user.html with email in the URL
//             window.location.href = `user.html?email=${encodeURIComponent(email)}`;
//         } else {
//             alert("Invalid credentials. Please try again.");
//             console.error("Login failed", responseBody);
//         }
//     } catch (error) {
//         console.error("Error:", error);
//     }
document.addEventListener("DOMContentLoaded", function () {
    // Fetch user data from localStorage
    const userData = JSON.parse(localStorage.getItem("user"));

    if (!userData) {
        alert("You must log in first!");
        window.location.href = "login.html"; // Redirect to login if no user is found
    } else {
        console.log("User data:", userData); // Debugging

        // Ensure the element exists before trying to update it
        const userNameElement = document.getElementById("user-name");
        if (userNameElement) {
            userNameElement.innerText = userData.Name || "User";
            email = userData.email||"email";
        } else {
            console.error("Element with ID 'user-name' not found in the DOM.");
        }
    }
    const BASE_ID = "appSunSHf6bdvfsLj"; // Replace with your Airtable Base ID
const TABLE_NAME = "user_data"; // Replace with your Table Name or friendly name
const API_KEY = "patrBN0pEEoKIgr8j.0a00b86c77c9ddd225c5e7d9d74a2f8e4e1ced5115ab56137dec66358fb0c5d7"; // Replace with your Airtable API Key
const email =" ";

document.getElementById("saveButton").addEventListener(onclick,()=>{
console.log("entered in save button click ");
// ‚úÖ Function to write user data to Airtable
async function writeToAirtable( email, photo,video) {
  console.log("enter in write to table ");
  const url = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`;
  const record = {
    records: [
      {
        fields: {
          
          email: email, // Email field in Airtable
          photo: photo, // photo field in Airtable
          video: video, // photo field in Airtable
                },
              },
            ],
          };
          
          console.log("enter in save button click ");
    try {
        const response = await fetch(url, {
            method: "POST",
            headers: {
                Authorization: `Bearer ${API_KEY}`,
                "Content-Type": "application/json",
            },
            body: JSON.stringify(record),
        });

        const responseBody = await response.json();

        if (response.ok) {
            console.log("writing to db successful", responseBody);
            
        } else {
            alert("Error in uploading to db. Please try again.");
            console.error("Error signing up", responseBody);
        }
    } catch (error) {
        console.error("Error:", error);
    }
}
});

  });

// }
</script>
<!-- <script src="./user.js"></script> -->
</head>
<body>
  
  <header class="header">
   <div class="brand"><h1>üé• PhotoSnap Studio</h1></div>
   <div id="nameBox">Welcome, <span id="user-name">User</span>!</div>
   <div class="buttons" style="display: flex; justify-content: space-around;">
    <a href="./profile.html"><button class="profile-button"></button> </a>   
    <button class="theme-toggle" id="themeToggle">üåô</button>
  </div>
    
  </header>
  <div class="page-container">
    <main>
        <div class="camera-container">
            <video id="video" class="video-frame" autoplay></video>
            <div class="timer" id="timer">00:00</div>
          </div>
      <div class="controls">
        <button id="photoModeButton" class="control-btn">üì∏ Photo Mode</button>
        <button id="videoModeButton" class="control-btn">üé• Video Mode</button>
        <button id="reverseCameraButton" class="control-btn"> <img src="./752356.png" width="20" alt="reverse"> </button>
      </div>
        
        <div class="controls">
<!-- Capture Button (Hidden by Default) -->
        <button id="captureButton" class="control-btn" style="display: none;">üì∑ Capture</button>
        <button id="pauseButton" class="control-btn" style="display: none;">‚è∏ Pause</button>
        <button id="continueButton" class="control-btn" style="display: none;">‚ñ∂ Continue</button>
        <button id="stopButton" class="control-btn" style="display: none;">‚èπ Stop</button>
        <button id="saveButton" class="control-btn" style="display: none;">üíæ Save</button>
      </div>

     <!-- Filter Buttons -->
<div class="filter-container">
    <button onclick="applyFilter('grayscale(100%)')" class="filter-btn">Grayscale</button>
    <button onclick="applyFilter('sepia(100%)')" class="filter-btn">Sepia</button>
    <button onclick="applyFilter('brightness(150%)')" class="filter-btn">Brightness</button> <!-- New Brightness Button -->
    <button onclick="resetFilter()" class="filter-btn reset-btn">Reset</button>
</div>

    </main>
  </div>
</body>
<script src="user.js"></script>
</html>
